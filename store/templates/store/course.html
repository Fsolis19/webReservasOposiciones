{% extends 'store/main.html' %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-6">
            {% if course.image %}
                <img class="img-fluid" src="{{ course.image.url }}" alt="{{ course.name }}">
            {% else %}
                <img class="img-fluid" src="{% static 'products/placeholder.png' %}" alt="{{ course.name }}">
            {% endif %}
        </div>
        <div class="col-md-6">
            <h2>{{ course.name }}</h2>
            <h4>{{ course.course_type.name }}</h4>
            <p><strong>Ciudad:</strong> {{ course.city }}</p>
            <p><strong>Precio:</strong> {{ course.price|floatformat:2 }} €</p>
            <p><strong>Detalles:</strong> {{ course.details }}</p>
            <p><strong>Duración:</strong> {{ duration }} días</p>
            <p><strong>Fecha de inicio:</strong> {{ course.start_date }}</p>
            <p><strong>Fecha de fin:</strong> {{ course.end_date }}</p>
            <p><strong>Disponibilidad:</strong> {{ is_available|yesno:"Disponible,No disponible" }}</p>
            <div style="flex-direction: column;">
                <!-- Botón de agregar al carrito -->
                <button class="btn btn-outline-success" id="reservar-btn" data-course-id="{{ course.id }}">Reservar curso</button>

                <script>
                document.getElementById("reservar-btn").addEventListener("click", function () {
                    // Obtiene el ID del curso desde el botón
                    const courseId = this.getAttribute("data-course-id");
                    const url = `/course/${courseId}/add-to-cart/`;  // URL para agregar el curso al carrito

                    fetch(url, { 
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "X-CSRFToken": getCSRFToken(),  // Token CSRF para proteger la solicitud
                        },
                        body: JSON.stringify({})  // Cuerpo de la solicitud, puedes agregar más datos si es necesario
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert("¡Reserva realizada con éxito!");
                        } else if (data.error) {
                            alert(data.error);
                        }
                    })
                    .catch(error => {
                        console.error("Error:", error);
                        alert("Hubo un error al realizar la reserva.");
                    });
                });

                // Función para obtener el token CSRF del documento (si estás usando protección CSRF)
                function getCSRFToken() {
                    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                    return csrfToken;
                }
                </script>
                <!-- Botón de agregar al carrito -->

            </div>
        </div>
    </div>
</div>
<script type="text/javascript" src="{% static 'js/course.js' %}"></script>
{% endblock %}
