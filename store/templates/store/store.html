{% extends 'store/main.html' %}
{% load static %}
{% block content %}
<div class="row">
    <div class="col-lg-3">
        <form action="/" method="get">
            <!-- Filtro por nombre de curso -->
             <div>
                <input type="text" name="q" placeholder="Buscar curso" value="{{ query }}">
             </div>
            
            <!-- Filtro por precio mínimo -->
             <div>
                <label for="price_min">Precio mínimo</label>
                <input type="number" name="price_min" value="{{ price_min }}" min="0">
             </div>

            <!-- Filtro por precio máximo -->
             <div>
                <label for="price_max">Precio máximo</label>
                <input type="number" name="price_max" value="{{ price_max }}" min="0">
             </div>

            <!-- Filtro por tipo de curso -->
             <div>
                <label for="course_type">Tipo de curso</label>
                <select name="course_type">
                    <option value="">--Seleccionar tipo--</option>
                    {% for course_type in course_types %}
                        <option value="{{ course_type.id }}" {% if course_type.id == course_type_id %}selected{% endif %}>{{ course_type.name }}</option>
                    {% endfor %}
                </select>
             </div>

            <!-- Filtro por ciudad -->
             <div>
                <label for="city">Ciudad</label>
                <select name="city">
                    <option value="">--Seleccionar ciudad--</option>
                    {% for city_item in city_list %}
                        <option value="{{ city_item.city }}" {% if city_item.city == city %}selected{% endif %}>{{ city_item.city }}</option>
                    {% endfor %}
                </select>
             </div>

            <!-- Botón de filtro -->
            <button type="submit">Filtrar</button>
        </form>
    </div>

    <div class="col-lg-9">
        <h2>Todos los cursos:</h2>
        <p>{{ filters_applied }}</p>
        {% if courses|length == 0 %}
            <p>No se encontraron cursos.</p>
        {% elif courses|length > 1 %}
            <p>[{{ courses|length }} resultados]</p>
        {% else %}
            <p>[{{ courses|length }} resultado]</p>
        {% endif %}
    </div>

    <!-- Mostrar los cursos filtrados -->
    {% for course in courses %}
        <div class="col-lg-4">
            <a href="{% url 'details' course.id %}">
                {% if course.image %}
                    <img class="thumbnail" src="{{ course.image.url }}">
                {% else %}
                    <img class="thumbnail" src="/products/placeholder.png">
                {% endif %}
            </a>
            <div class="box-element product">
                <h6><strong>{{ course.name }}</strong></h6>
                <h8><strong>Ciudad:</strong> {{ course.city }}</h8>
                <h8><strong>Tipo:</strong> {{ course.course_type }}</h8>
                <h8><strong>Disponibilidad:</strong> {{ course.is_available|yesno:"Disponible,No disponible" }}</h8>
                <hr>
                <a href="{% url 'details' course.id %}">
                    <button class="btn btn-outline-secondary add-btn">Ver curso</button>
                </a>
                <h4 style="display: inline-block; float: right;"><strong>
                    {{ course.price|floatformat:2 }} €
                </strong></h4>
            </div>
        </div>
    {% endfor %}
</div>
{% endblock content %}
